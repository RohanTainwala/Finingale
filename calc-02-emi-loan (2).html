<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>EMI / Loan Repayment Calculator ‚Äî Finingale</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700;900&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  --navy:#0A1628;--navy2:#0E1F3D;--navy3:#162847;
  --gold:#C9A84C;--gold2:#E8C96B;
  --white:#F8F5EE;--grey:#8A95A3;
  --blue:#60a5fa;--red:#f87171;
}
body{font-family:'DM Sans',sans-serif;background:var(--navy);color:var(--white);min-height:100vh;padding:40px 24px;}
body::before{content:'';position:fixed;inset:0;background-image:linear-gradient(rgba(201,168,76,0.03) 1px,transparent 1px),linear-gradient(90deg,rgba(201,168,76,0.03) 1px,transparent 1px);background-size:60px 60px;pointer-events:none;z-index:0;}
.wrapper{max-width:1080px;margin:0 auto;position:relative;z-index:1;}

.calc-header{margin-bottom:36px;}
.calc-tag{font-size:0.68rem;font-weight:600;letter-spacing:0.25em;text-transform:uppercase;color:var(--gold);display:flex;align-items:center;gap:10px;margin-bottom:10px;}
.calc-tag::before{content:'';width:22px;height:1px;background:var(--gold);}
.calc-title{font-family:'Playfair Display',serif;font-size:clamp(1.8rem,3.5vw,2.8rem);font-weight:900;line-height:1.1;margin-bottom:8px;}
.calc-title span{color:var(--gold);}
.calc-desc{font-size:0.88rem;color:var(--grey);font-weight:300;max-width:600px;line-height:1.75;}

.calc-body{display:grid;grid-template-columns:370px 1fr;gap:20px;align-items:start;}
@media(max-width:820px){.calc-body{grid-template-columns:1fr;}}

.panel{background:var(--navy2);border:1px solid rgba(201,168,76,0.13);border-radius:8px;padding:28px;}
.panel+.panel{margin-top:20px;}
.panel-title{font-size:0.68rem;font-weight:600;letter-spacing:0.2em;text-transform:uppercase;color:var(--gold);margin-bottom:20px;padding-bottom:12px;border-bottom:1px solid rgba(201,168,76,0.12);}

.input-group{margin-bottom:20px;}
.input-label{font-size:0.7rem;font-weight:600;letter-spacing:0.1em;text-transform:uppercase;color:var(--grey);margin-bottom:8px;display:block;}
.input-hint{font-size:0.65rem;color:rgba(138,149,163,0.6);margin-bottom:6px;display:block;}
.input-wrap{position:relative;display:flex;align-items:center;}
.input-prefix{position:absolute;left:14px;font-size:0.88rem;font-weight:600;color:var(--gold);pointer-events:none;z-index:1;}
.input-suffix{position:absolute;right:14px;font-size:0.88rem;font-weight:500;color:var(--grey);pointer-events:none;z-index:1;}
.field{width:100%;padding:12px 14px;background:var(--navy3);border:1px solid rgba(201,168,76,0.18);border-radius:5px;color:var(--white);font-size:0.95rem;font-weight:500;font-family:'DM Sans',sans-serif;outline:none;transition:border-color 0.2s,box-shadow 0.2s;-moz-appearance:textfield;}
.field::-webkit-outer-spin-button,.field::-webkit-inner-spin-button{-webkit-appearance:none;margin:0;}
.field:focus{border-color:var(--gold);box-shadow:0 0 0 3px rgba(201,168,76,0.1);}
.field.has-prefix{padding-left:32px;}
.field.has-suffix{padding-right:40px;}
.field.error{border-color:var(--red);}
.error-msg{font-size:0.65rem;color:var(--red);margin-top:5px;display:none;}
.error-msg.show{display:block;}

/* Loan type buttons */
.loan-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:6px;margin-top:6px;}
.loan-btn{padding:10px 4px;border:1px solid rgba(201,168,76,0.18);background:transparent;color:var(--grey);font-size:0.75rem;font-family:'DM Sans',sans-serif;border-radius:4px;cursor:pointer;transition:all 0.18s;text-align:center;}
.loan-btn.active{background:var(--gold);color:var(--navy);border-color:var(--gold);font-weight:700;}
.loan-btn:hover:not(.active){border-color:var(--gold);color:var(--gold);}

.calc-btn{width:100%;margin-top:8px;padding:14px;background:var(--gold);color:var(--navy);font-size:0.85rem;font-weight:700;font-family:'DM Sans',sans-serif;letter-spacing:0.1em;text-transform:uppercase;border:none;border-radius:5px;cursor:pointer;transition:background 0.2s,transform 0.15s;}
.calc-btn:hover{background:var(--gold2);transform:translateY(-1px);}
.calc-btn:active{transform:translateY(0);}

/* EMI hero */
.emi-hero{background:linear-gradient(135deg,rgba(201,168,76,0.12),rgba(201,168,76,0.04));border:1px solid rgba(201,168,76,0.35);border-radius:8px;padding:24px;text-align:center;margin-bottom:16px;}
.emi-label{font-size:0.68rem;font-weight:600;letter-spacing:0.2em;text-transform:uppercase;color:var(--gold);margin-bottom:8px;}
.emi-value{font-family:'Playfair Display',serif;font-size:clamp(2rem,5vw,3rem);font-weight:900;color:var(--gold2);}
.emi-sub{font-size:0.78rem;color:var(--grey);margin-top:6px;}

.results-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:20px;}
.result-card{background:var(--navy3);border:1px solid rgba(201,168,76,0.1);border-radius:5px;padding:16px;}
.result-label{font-size:0.63rem;font-weight:600;letter-spacing:0.15em;text-transform:uppercase;color:var(--grey);margin-bottom:6px;}
.result-value{font-family:'Playfair Display',serif;font-size:1.25rem;font-weight:700;color:var(--white);}
.result-value.bad{color:var(--red);}
.result-sub{font-size:0.67rem;color:var(--grey);margin-top:3px;}

/* Empty state */
.empty-state{text-align:center;padding:40px 20px;color:var(--grey);}
.empty-state-icon{font-size:2.5rem;margin-bottom:12px;opacity:0.4;}
.empty-state-text{font-size:0.85rem;line-height:1.6;}

/* Donut */
.donut-section{display:flex;gap:24px;align-items:center;flex-wrap:wrap;margin-bottom:4px;}
.donut-wrap{position:relative;width:180px;height:180px;flex-shrink:0;}
.donut-center{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;pointer-events:none;}
.donut-center-label{font-size:0.6rem;color:var(--grey);text-transform:uppercase;letter-spacing:0.1em;margin-bottom:4px;}
.donut-center-val{font-family:'Playfair Display',serif;font-size:1.1rem;font-weight:700;color:var(--gold2);}
.donut-legend{flex:1;min-width:140px;}
.legend-row{display:flex;align-items:center;gap:8px;margin-bottom:10px;font-size:0.75rem;color:var(--grey);}
.legend-dot{width:10px;height:10px;border-radius:2px;flex-shrink:0;}

/* Chart */
.chart-container{position:relative;height:240px;}

/* Amortisation table */
.amort-table{width:100%;border-collapse:collapse;font-size:0.75rem;margin-top:16px;}
.amort-table th{font-size:0.62rem;font-weight:600;letter-spacing:0.12em;text-transform:uppercase;color:var(--gold);padding:8px 10px;border-bottom:1px solid rgba(201,168,76,0.15);text-align:right;}
.amort-table th:first-child{text-align:left;}
.amort-table td{padding:8px 10px;border-bottom:1px solid rgba(255,255,255,0.04);color:var(--grey);text-align:right;}
.amort-table td:first-child{text-align:left;color:var(--white);}
.amort-table tr:hover td{background:rgba(201,168,76,0.04);}
.toggle-btn{display:block;width:100%;margin-top:10px;padding:10px;border:1px solid rgba(201,168,76,0.2);background:transparent;color:var(--gold);font-size:0.75rem;font-family:'DM Sans',sans-serif;border-radius:3px;cursor:pointer;transition:all 0.18s;text-align:center;}
.toggle-btn:hover{background:rgba(201,168,76,0.08);}

.calc-footer{margin-top:24px;padding-top:14px;border-top:1px solid rgba(201,168,76,0.1);display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:8px;}
.brand{font-family:'Playfair Display',serif;font-size:1rem;font-weight:900;}
.brand span{color:var(--gold);}
.disclaimer{font-size:0.67rem;color:var(--grey);}
</style>
</head>
<body>
<div class="wrapper">

  <div class="calc-header">
    <div class="calc-tag">Calculator 02 ¬∑ Finingale</div>
    <h1 class="calc-title">EMI / Loan <span>Repayment</span></h1>
    <p class="calc-desc">Calculate your monthly instalment, total interest payable, and full amortisation schedule for any loan ‚Äî home, car, personal or business.</p>
  </div>

  <div class="calc-body">

    <!-- INPUTS -->
    <div>
      <div class="panel">
        <div class="panel-title">Loan Details</div>

        <div class="input-group">
          <label class="input-label">Loan Amount</label>
          <span class="input-hint">Total amount you wish to borrow</span>
          <div class="input-wrap">
            <span class="input-prefix">$</span>
            <input type="number" id="amount" class="field has-prefix" placeholder="e.g. 250000" min="0" step="any"/>
          </div>
          <div class="error-msg" id="err-amount">Please enter a valid loan amount</div>
        </div>

        <div class="input-group">
          <label class="input-label">Annual Interest Rate</label>
          <span class="input-hint">The yearly interest rate on your loan</span>
          <div class="input-wrap">
            <input type="number" id="rate" class="field has-suffix" placeholder="e.g. 6.5" min="0" max="100" step="any"/>
            <span class="input-suffix">%</span>
          </div>
          <div class="error-msg" id="err-rate">Please enter a rate between 0 and 100</div>
        </div>

        <div class="input-group">
          <label class="input-label">Loan Tenure</label>
          <span class="input-hint">Duration of the loan in years</span>
          <div class="input-wrap">
            <input type="number" id="tenure" class="field has-suffix" placeholder="e.g. 20" min="1" max="30" step="1"/>
            <span class="input-suffix">yrs</span>
          </div>
          <div class="error-msg" id="err-tenure">Please enter between 1 and 30 years</div>
        </div>

        <div class="input-group" style="margin-bottom:16px;">
          <label class="input-label">Loan Type</label>
          <span class="input-hint">Select for reference ‚Äî adjust rate manually</span>
          <div class="loan-grid">
            <button class="loan-btn active" data-rate="6.5">üè† Home</button>
            <button class="loan-btn" data-rate="8.5">üöó Car</button>
            <button class="loan-btn" data-rate="12">üíº Personal</button>
          </div>
        </div>

        <button class="calc-btn" onclick="calculate()">Calculate ‚Üí</button>
      </div>
    </div>

    <!-- RESULTS -->
    <div>
      <div class="panel">
        <div class="panel-title">Results</div>

        <div class="empty-state" id="empty-state">
          <div class="empty-state-icon">üè¶</div>
          <div class="empty-state-text">Enter your loan details on the left<br/>and click <strong style="color:var(--gold)">Calculate</strong> to see your EMI.</div>
        </div>

        <div id="results-content" style="display:none;">
          <div class="emi-hero">
            <div class="emi-label">Your Monthly EMI</div>
            <div class="emi-value" id="res-emi">‚Äî</div>
            <div class="emi-sub" id="res-emi-sub">‚Äî</div>
          </div>

          <div class="results-grid">
            <div class="result-card">
              <div class="result-label">Principal Amount</div>
              <div class="result-value" id="res-principal">‚Äî</div>
              <div class="result-sub">Original loan</div>
            </div>
            <div class="result-card">
              <div class="result-label">Total Interest</div>
              <div class="result-value bad" id="res-interest">‚Äî</div>
              <div class="result-sub" id="res-interest-pct">‚Äî</div>
            </div>
            <div class="result-card">
              <div class="result-label">Total Repayment</div>
              <div class="result-value" id="res-total">‚Äî</div>
              <div class="result-sub">Principal + interest</div>
            </div>
            <div class="result-card">
              <div class="result-label">Cost of Borrowing</div>
              <div class="result-value bad" id="res-ratio">‚Äî</div>
              <div class="result-sub">Interest per $1 borrowed</div>
            </div>
          </div>

          <div class="donut-section">
            <div class="donut-wrap">
              <canvas id="donutChart"></canvas>
              <div class="donut-center">
                <div class="donut-center-label">Interest</div>
                <div class="donut-center-val" id="donut-pct">‚Äî</div>
              </div>
            </div>
            <div class="donut-legend">
              <div class="legend-row"><div class="legend-dot" style="background:#60a5fa;"></div> Principal: <strong id="leg-p" style="color:var(--white);margin-left:4px;">‚Äî</strong></div>
              <div class="legend-row"><div class="legend-dot" style="background:#f87171;"></div> Interest: <strong id="leg-i" style="color:var(--white);margin-left:4px;">‚Äî</strong></div>
              <p style="font-size:0.75rem;color:var(--grey);line-height:1.7;margin-top:8px;">For every <strong style="color:var(--white);">$1</strong> borrowed, you repay <strong style="color:var(--red);" id="payback-ratio">‚Äî</strong> total.</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Chart + Amortisation -->
      <div class="panel" id="chart-panel" style="display:none;">
        <div class="panel-title">Principal vs Interest Over Time</div>
        <div class="chart-container">
          <canvas id="amortChart"></canvas>
        </div>

        <table class="amort-table">
          <thead>
            <tr>
              <th>Year</th>
              <th>EMI (Annual)</th>
              <th>Principal Paid</th>
              <th>Interest Paid</th>
              <th>Balance</th>
            </tr>
          </thead>
          <tbody id="amort-tbody"></tbody>
        </table>
        <button class="toggle-btn" id="toggle-rows">Show all years ‚Üì</button>
      </div>
    </div>
  </div>

  <div class="calc-footer">
    <div class="brand">Fining<span>ale</span></div>
    <div class="disclaimer">For educational purposes only. Not financial advice.</div>
  </div>
</div>

<script>
const fmt = n => '$' + Math.round(n).toLocaleString('en-US');
const fmtPct = n => n.toFixed(1) + '%';
let donutInstance = null, amortInstance = null;
let fullAmortData = [], showAll = false;

function showError(id, show) {
  const el = document.getElementById('err-' + id);
  const field = document.getElementById(id);
  if (!el) return;
  if (show) { el.classList.add('show'); field.classList.add('error'); }
  else { el.classList.remove('show'); field.classList.remove('error'); }
}

function validate() {
  const A = parseFloat(document.getElementById('amount').value);
  const r = parseFloat(document.getElementById('rate').value);
  const t = parseFloat(document.getElementById('tenure').value);
  let valid = true;
  if (!A || A <= 0) { showError('amount', true); valid = false; } else showError('amount', false);
  if (isNaN(r) || r < 0 || r > 100) { showError('rate', true); valid = false; } else showError('rate', false);
  if (!t || t < 1 || t > 30) { showError('tenure', true); valid = false; } else showError('tenure', false);
  return valid;
}

function buildAmortTable(data, all) {
  const rows = all ? data : data.slice(0, 5);
  document.getElementById('amort-tbody').innerHTML = rows.map(r => `
    <tr>
      <td>Year ${r.year}</td>
      <td>${fmt(r.emiAnnual)}</td>
      <td>${fmt(r.principalPaid)}</td>
      <td>${fmt(r.interestPaid)}</td>
      <td>${fmt(Math.max(0, r.balance))}</td>
    </tr>`).join('');
  document.getElementById('toggle-rows').textContent = all ? 'Show less ‚Üë' : `Show all ${data.length} years ‚Üì`;
}

document.getElementById('toggle-rows').addEventListener('click', function () {
  showAll = !showAll;
  buildAmortTable(fullAmortData, showAll);
});

function calculate() {
  if (!validate()) return;

  const P = parseFloat(document.getElementById('amount').value);
  const annualRate = parseFloat(document.getElementById('rate').value) / 100;
  const years = parseInt(document.getElementById('tenure').value);
  const r = annualRate / 12;
  const n = years * 12;

  // EMI formula
  const emi = r > 0 ? P * r * Math.pow(1+r,n) / (Math.pow(1+r,n) - 1) : P / n;
  const totalPayment = emi * n;
  const totalInterest = totalPayment - P;

  // Show results
  document.getElementById('empty-state').style.display = 'none';
  document.getElementById('results-content').style.display = 'block';
  document.getElementById('chart-panel').style.display = 'block';

  document.getElementById('res-emi').textContent = fmt(emi);
  document.getElementById('res-emi-sub').textContent = 'for ' + n + ' months (' + years + (years === 1 ? ' year' : ' years') + ')';
  document.getElementById('res-principal').textContent = fmt(P);
  document.getElementById('res-interest').textContent = fmt(totalInterest);
  document.getElementById('res-interest-pct').textContent = fmtPct(totalInterest / P * 100) + ' of principal';
  document.getElementById('res-total').textContent = fmt(totalPayment);
  document.getElementById('res-ratio').textContent = '$' + (totalPayment / P).toFixed(2);
  document.getElementById('donut-pct').textContent = fmtPct(totalInterest / totalPayment * 100);
  document.getElementById('leg-p').textContent = fmt(P);
  document.getElementById('leg-i').textContent = fmt(totalInterest);
  document.getElementById('payback-ratio').textContent = '$' + (totalPayment / P).toFixed(2);

  // Donut chart
  if (donutInstance) donutInstance.destroy();
  const dCtx = document.getElementById('donutChart').getContext('2d');
  donutInstance = new Chart(dCtx, {
    type: 'doughnut',
    data: {
      labels: ['Principal', 'Interest'],
      datasets: [{ data: [Math.round(P), Math.round(totalInterest)], backgroundColor: ['#60a5fa', '#f87171'], borderColor: '#0E1F3D', borderWidth: 3, hoverOffset: 6 }]
    },
    options: {
      responsive: true, maintainAspectRatio: true, cutout: '72%',
      animation: { duration: 700, easing: 'easeInOutQuart' },
      plugins: {
        legend: { display: false },
        tooltip: { backgroundColor: '#0E1F3D', borderColor: 'rgba(201,168,76,0.3)', borderWidth: 1, titleColor: '#C9A84C', bodyColor: '#F8F5EE', padding: 10, callbacks: { label: c => ' ' + c.label + ': ' + fmt(c.raw) } }
      }
    }
  });

  // Amortisation
  const chartLabels = [], chartPrincipal = [], chartInterest = [];
  fullAmortData = [];
  let balance = P;
  for (let y = 1; y <= years; y++) {
    let yP = 0, yI = 0;
    for (let m = 0; m < 12 && balance > 0; m++) {
      const iP = balance * r;
      const pP = Math.min(emi - iP, balance);
      yI += iP; yP += pP; balance -= pP;
    }
    chartLabels.push('Yr ' + y);
    chartPrincipal.push(Math.round(yP));
    chartInterest.push(Math.round(yI));
    fullAmortData.push({ year: y, emiAnnual: emi * 12, principalPaid: yP, interestPaid: yI, balance });
  }

  if (amortInstance) amortInstance.destroy();
  const aCtx = document.getElementById('amortChart').getContext('2d');
  const gP = aCtx.createLinearGradient(0,0,0,240);
  gP.addColorStop(0,'rgba(96,165,250,0.75)'); gP.addColorStop(1,'rgba(96,165,250,0.2)');
  const gI = aCtx.createLinearGradient(0,0,0,240);
  gI.addColorStop(0,'rgba(248,113,113,0.75)'); gI.addColorStop(1,'rgba(248,113,113,0.2)');

  amortInstance = new Chart(aCtx, {
    type: 'bar',
    data: {
      labels: chartLabels,
      datasets: [
        { label: 'Principal', data: chartPrincipal, backgroundColor: gP, borderRadius: 2, borderSkipped: false },
        { label: 'Interest', data: chartInterest, backgroundColor: gI, borderRadius: 2, borderSkipped: false }
      ]
    },
    options: {
      responsive: true, maintainAspectRatio: false,
      animation: { duration: 700, easing: 'easeInOutQuart' },
      interaction: { mode: 'index', intersect: false },
      plugins: {
        legend: { labels: { color: '#8A95A3', font: { family: 'DM Sans', size: 11 }, boxWidth: 12 } },
        tooltip: { backgroundColor: '#0E1F3D', borderColor: 'rgba(201,168,76,0.3)', borderWidth: 1, titleColor: '#C9A84C', bodyColor: '#F8F5EE', padding: 12, callbacks: { label: c => ' ' + c.dataset.label + ': ' + fmt(c.raw) } }
      },
      scales: {
        x: { stacked: true, grid: { color: 'rgba(255,255,255,0.03)' }, ticks: { color: '#8A95A3', font: { family: 'DM Sans', size: 10 }, maxTicksLimit: 10 } },
        y: { stacked: true, grid: { color: 'rgba(255,255,255,0.04)' }, ticks: { color: '#8A95A3', font: { family: 'DM Sans', size: 10 }, callback: v => '$' + (v >= 1e6 ? (v/1e6).toFixed(1)+'M' : v >= 1000 ? (v/1000).toFixed(0)+'K' : v) } }
      }
    }
  });

  buildAmortTable(fullAmortData, showAll);
}

// Enter key support
document.querySelectorAll('.field').forEach(f => f.addEventListener('keydown', e => { if (e.key === 'Enter') calculate(); }));

// Loan type buttons ‚Äî auto-fill rate
document.querySelectorAll('.loan-btn').forEach(btn => btn.addEventListener('click', function () {
  document.querySelectorAll('.loan-btn').forEach(b => b.classList.remove('active'));
  this.classList.add('active');
  document.getElementById('rate').value = this.dataset.rate;
}));
</script>
</body>
</html>
