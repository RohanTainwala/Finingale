<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Bond Pricing & Yield Calculator â€” Finingale</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700;900&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{--navy:#0A1628;--navy2:#0E1F3D;--navy3:#162847;--gold:#C9A84C;--gold2:#E8C96B;--white:#F8F5EE;--grey:#8A95A3;--blue:#60a5fa;--green:#4ade80;--red:#f87171;}
body{font-family:'DM Sans',sans-serif;background:var(--navy);color:var(--white);min-height:100vh;padding:40px 24px;}
body::before{content:'';position:fixed;inset:0;background-image:linear-gradient(rgba(201,168,76,0.03) 1px,transparent 1px),linear-gradient(90deg,rgba(201,168,76,0.03) 1px,transparent 1px);background-size:60px 60px;pointer-events:none;z-index:0;}
.wrapper{max-width:1080px;margin:0 auto;position:relative;z-index:1;}
.calc-header{margin-bottom:36px;}
.calc-tag{font-size:0.68rem;font-weight:600;letter-spacing:0.25em;text-transform:uppercase;color:var(--gold);display:flex;align-items:center;gap:10px;margin-bottom:10px;}
.calc-tag::before{content:'';width:22px;height:1px;background:var(--gold);}
.calc-title{font-family:'Playfair Display',serif;font-size:clamp(1.8rem,3.5vw,2.8rem);font-weight:900;line-height:1.1;margin-bottom:8px;}
.calc-title span{color:var(--gold);}
.calc-desc{font-size:0.88rem;color:var(--grey);font-weight:300;max-width:600px;line-height:1.75;}
.calc-body{display:grid;grid-template-columns:370px 1fr;gap:20px;align-items:start;}
@media(max-width:820px){.calc-body{grid-template-columns:1fr;}}
.panel{background:var(--navy2);border:1px solid rgba(201,168,76,0.13);border-radius:8px;padding:28px;}
.panel+.panel{margin-top:20px;}
.panel-title{font-size:0.68rem;font-weight:600;letter-spacing:0.2em;text-transform:uppercase;color:var(--gold);margin-bottom:20px;padding-bottom:12px;border-bottom:1px solid rgba(201,168,76,0.12);}
.input-group{margin-bottom:20px;}
.input-label{font-size:0.7rem;font-weight:600;letter-spacing:0.1em;text-transform:uppercase;color:var(--grey);margin-bottom:6px;display:block;}
.input-hint{font-size:0.65rem;color:rgba(138,149,163,0.6);margin-bottom:6px;display:block;}
.input-wrap{position:relative;display:flex;align-items:center;}
.input-prefix{position:absolute;left:14px;font-size:0.88rem;font-weight:600;color:var(--gold);pointer-events:none;z-index:1;}
.input-suffix{position:absolute;right:14px;font-size:0.88rem;font-weight:500;color:var(--grey);pointer-events:none;z-index:1;}
.field{width:100%;padding:12px 14px;background:var(--navy3);border:1px solid rgba(201,168,76,0.18);border-radius:5px;color:var(--white);font-size:0.95rem;font-weight:500;font-family:'DM Sans',sans-serif;outline:none;transition:border-color 0.2s,box-shadow 0.2s;-moz-appearance:textfield;}
.field::-webkit-outer-spin-button,.field::-webkit-inner-spin-button{-webkit-appearance:none;margin:0;}
.field:focus{border-color:var(--gold);box-shadow:0 0 0 3px rgba(201,168,76,0.1);}
.field.has-prefix{padding-left:32px;}
.field.has-suffix{padding-right:40px;}
.field.error{border-color:var(--red);}
.error-msg{font-size:0.65rem;color:var(--red);margin-top:5px;display:none;}
.error-msg.show{display:block;}
.toggle-grid{display:grid;grid-template-columns:1fr 1fr;gap:6px;margin-top:6px;}
.toggle-btn{padding:10px;border:1px solid rgba(201,168,76,0.18);background:transparent;color:var(--grey);font-size:0.75rem;font-family:'DM Sans',sans-serif;border-radius:4px;cursor:pointer;transition:all 0.18s;text-align:center;}
.toggle-btn.active{background:var(--gold);color:var(--navy);border-color:var(--gold);font-weight:700;}
.toggle-btn:hover:not(.active){border-color:var(--gold);color:var(--gold);}
.calc-btn{width:100%;margin-top:8px;padding:14px;background:var(--gold);color:var(--navy);font-size:0.85rem;font-weight:700;font-family:'DM Sans',sans-serif;letter-spacing:0.1em;text-transform:uppercase;border:none;border-radius:5px;cursor:pointer;transition:background 0.2s,transform 0.15s;}
.calc-btn:hover{background:var(--gold2);transform:translateY(-1px);}
.empty-state{text-align:center;padding:40px 20px;color:var(--grey);}
.empty-state-icon{font-size:2.5rem;margin-bottom:12px;opacity:0.4;}
.empty-state-text{font-size:0.85rem;line-height:1.6;}
.hero-result{background:linear-gradient(135deg,rgba(201,168,76,0.12),rgba(201,168,76,0.04));border:1px solid rgba(201,168,76,0.35);border-radius:8px;padding:22px;text-align:center;margin-bottom:16px;}
.hero-label{font-size:0.68rem;font-weight:600;letter-spacing:0.2em;text-transform:uppercase;color:var(--gold);margin-bottom:8px;}
.hero-value{font-family:'Playfair Display',serif;font-size:2.8rem;font-weight:900;color:var(--gold2);}
.hero-sub{font-size:0.78rem;color:var(--grey);margin-top:6px;}
.status-pill{display:inline-block;padding:5px 14px;border-radius:3px;font-size:0.72rem;font-weight:700;margin-top:8px;}
.status-pill.premium{background:rgba(248,113,113,0.15);border:1px solid rgba(248,113,113,0.3);color:var(--red);}
.status-pill.discount{background:rgba(74,222,128,0.15);border:1px solid rgba(74,222,128,0.3);color:var(--green);}
.status-pill.par{background:rgba(201,168,76,0.15);border:1px solid rgba(201,168,76,0.3);color:var(--gold2);}
.results-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:16px;}
.result-card{background:var(--navy3);border:1px solid rgba(201,168,76,0.1);border-radius:5px;padding:14px;}
.result-label{font-size:0.62rem;font-weight:600;letter-spacing:0.15em;text-transform:uppercase;color:var(--grey);margin-bottom:5px;}
.result-value{font-family:'Playfair Display',serif;font-size:1.2rem;font-weight:700;color:var(--white);}
.result-sub{font-size:0.65rem;color:var(--grey);margin-top:2px;}
.chart-container{position:relative;height:260px;}
.calc-footer{margin-top:24px;padding-top:14px;border-top:1px solid rgba(201,168,76,0.1);display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:8px;}
.brand{font-family:'Playfair Display',serif;font-size:1rem;font-weight:900;}
.brand span{color:var(--gold);}
.disclaimer{font-size:0.67rem;color:var(--grey);}
</style>
</head>
<body>
<div class="wrapper">
  <div class="calc-header">
    <div class="calc-tag">Calculator 10 Â· Finingale</div>
    <h1 class="calc-title">Bond Pricing <span>& Yield</span></h1>
    <p class="calc-desc">Calculate the fair price of a bond given a required yield, or find the Yield to Maturity (YTM) given a market price. Includes duration, convexity, and a full price-yield curve.</p>
  </div>
  <div class="calc-body">
    <div>
      <div class="panel">
        <div class="panel-title">Bond Details</div>
        <div class="input-group">
          <label class="input-label">Solve For</label>
          <div class="toggle-grid">
            <button class="toggle-btn active" data-solve="price">Bond Price</button>
            <button class="toggle-btn" data-solve="ytm">Yield (YTM)</button>
          </div>
        </div>
        <div class="input-group">
          <label class="input-label">Face Value (Par Value)</label>
          <span class="input-hint">Principal amount of the bond</span>
          <div class="input-wrap"><span class="input-prefix">$</span><input type="number" id="face" class="field has-prefix" placeholder="e.g. 1000" min="0" step="any"/></div>
          <div class="error-msg" id="err-face">Please enter a valid face value</div>
        </div>
        <div class="input-group">
          <label class="input-label">Annual Coupon Rate</label>
          <span class="input-hint">Annual interest rate stated on the bond</span>
          <div class="input-wrap"><input type="number" id="coupon" class="field has-suffix" placeholder="e.g. 5" min="0" max="100" step="any"/><span class="input-suffix">%</span></div>
          <div class="error-msg" id="err-coupon">Please enter a valid coupon rate</div>
        </div>
        <div class="input-group">
          <label class="input-label">Years to Maturity</label>
          <span class="input-hint">Remaining life of the bond</span>
          <div class="input-wrap"><input type="number" id="years" class="field has-suffix" placeholder="e.g. 10" min="1" max="100" step="1"/><span class="input-suffix">yrs</span></div>
          <div class="error-msg" id="err-years">Please enter a valid maturity</div>
        </div>
        <div class="input-group" id="ytm-input-group" style="display:none;">
          <label class="input-label">Market Price</label>
          <span class="input-hint">Current trading price of the bond</span>
          <div class="input-wrap"><span class="input-prefix">$</span><input type="number" id="mkt-price" class="field has-prefix" placeholder="e.g. 950" min="0" step="any"/></div>
          <div class="error-msg" id="err-mkt-price">Please enter a valid market price</div>
        </div>
        <div class="input-group" id="req-yield-group">
          <label class="input-label">Required Yield / Discount Rate</label>
          <span class="input-hint">Market required rate of return</span>
          <div class="input-wrap"><input type="number" id="req-yield" class="field has-suffix" placeholder="e.g. 6" min="0" max="100" step="any"/><span class="input-suffix">%</span></div>
          <div class="error-msg" id="err-req-yield">Please enter a valid yield</div>
        </div>
        <div class="input-group" style="margin-bottom:16px;">
          <label class="input-label">Coupon Frequency</label>
          <div class="toggle-grid">
            <button class="toggle-btn active" data-freq="2">Semi-Annual</button>
            <button class="toggle-btn" data-freq="1">Annual</button>
          </div>
        </div>
        <button class="calc-btn" onclick="calculate()">Calculate â†’</button>
      </div>
    </div>
    <div>
      <div class="panel">
        <div class="panel-title">Results</div>
        <div class="empty-state" id="empty-state">
          <div class="empty-state-icon">ðŸ“ˆ</div>
          <div class="empty-state-text">Enter bond details on the left<br/>and click <strong style="color:var(--gold)">Calculate</strong> to price the bond.</div>
        </div>
        <div id="results-content" style="display:none;">
          <div class="hero-result">
            <div class="hero-label" id="hero-label">Bond Price</div>
            <div class="hero-value" id="hero-value">â€”</div>
            <div class="hero-sub" id="hero-sub">â€”</div>
            <span class="status-pill" id="status-pill">â€”</span>
          </div>
          <div class="results-grid">
            <div class="result-card">
              <div class="result-label">Annual Coupon Payment</div>
              <div class="result-value" id="res-coupon-pay">â€”</div>
              <div class="result-sub">Cash received per year</div>
            </div>
            <div class="result-card">
              <div class="result-label">Current Yield</div>
              <div class="result-value" id="res-cy">â€”</div>
              <div class="result-sub">Coupon / Market Price</div>
            </div>
            <div class="result-card">
              <div class="result-label">Macaulay Duration</div>
              <div class="result-value" id="res-duration">â€”</div>
              <div class="result-sub">Weighted avg. time to cashflows</div>
            </div>
            <div class="result-card">
              <div class="result-label">Modified Duration</div>
              <div class="result-value" id="res-mod-dur">â€”</div>
              <div class="result-sub">Price sensitivity to yield change</div>
            </div>
            <div class="result-card">
              <div class="result-label">Total Coupon Income</div>
              <div class="result-value" id="res-total-coupon">â€”</div>
              <div class="result-sub">Over bond lifetime</div>
            </div>
            <div class="result-card">
              <div class="result-label">Capital Gain / Loss</div>
              <div class="result-value" id="res-cap-gain">â€”</div>
              <div class="result-sub">Price vs face value</div>
            </div>
          </div>
        </div>
      </div>
      <div class="panel" id="chart-panel" style="display:none;">
        <div class="panel-title">Priceâ€“Yield Curve</div>
        <div class="chart-container"><canvas id="bondChart"></canvas></div>
      </div>
    </div>
  </div>
  <div class="calc-footer">
    <div class="brand">Fining<span>ale</span></div>
    <div class="disclaimer">For educational purposes only. Not financial advice.</div>
  </div>
</div>
<script>
const fmt = n => '$' + parseFloat(n.toFixed(2)).toLocaleString('en-US',{minimumFractionDigits:2,maximumFractionDigits:2});
const fmtPct = n => n.toFixed(4) + '%';
let solveFor = 'price', couponFreq = 2, chartInstance = null;

document.querySelectorAll('[data-solve]').forEach(btn => btn.addEventListener('click', function() {
  document.querySelectorAll('[data-solve]').forEach(b => b.classList.remove('active'));
  this.classList.add('active'); solveFor = this.dataset.solve;
  document.getElementById('ytm-input-group').style.display = solveFor === 'ytm' ? 'block' : 'none';
  document.getElementById('req-yield-group').style.display = solveFor === 'price' ? 'block' : 'none';
}));
document.querySelectorAll('[data-freq]').forEach(btn => btn.addEventListener('click', function() {
  document.querySelectorAll('[data-freq]').forEach(b => b.classList.remove('active'));
  this.classList.add('active'); couponFreq = parseInt(this.dataset.freq);
}));

function bondPrice(face, couponRate, years, ytm, freq) {
  const c = face * couponRate / freq;
  const r = ytm / freq;
  const n = years * freq;
  let price = 0;
  for (let t = 1; t <= n; t++) price += c / Math.pow(1+r, t);
  price += face / Math.pow(1+r, n);
  return price;
}

function calcYTM(face, couponRate, years, mktPrice, freq) {
  let low = 0.0001, high = 1.0;
  for (let i = 0; i < 1000; i++) {
    const mid = (low + high) / 2;
    const p = bondPrice(face, couponRate, years, mid, freq);
    if (Math.abs(p - mktPrice) < 0.0001) return mid;
    if (p > mktPrice) low = mid; else high = mid;
  }
  return (low + high) / 2;
}

function calcDuration(face, couponRate, years, ytm, freq) {
  const c = face * couponRate / freq;
  const r = ytm / freq;
  const n = years * freq;
  let weightedSum = 0, price = 0;
  for (let t = 1; t <= n; t++) {
    const pv = c / Math.pow(1+r, t);
    weightedSum += (t/freq) * pv; price += pv;
  }
  const pvFace = face / Math.pow(1+r, n);
  weightedSum += years * pvFace; price += pvFace;
  return weightedSum / price;
}

function showError(id, show) {
  const el = document.getElementById('err-'+id), field = document.getElementById(id);
  if (!el) return;
  if (show) { el.classList.add('show'); if(field) field.classList.add('error'); }
  else { el.classList.remove('show'); if(field) field.classList.remove('error'); }
}

function calculate() {
  const face = parseFloat(document.getElementById('face').value);
  const couponRate = parseFloat(document.getElementById('coupon').value)/100;
  const years = parseInt(document.getElementById('years').value);
  let valid = true;
  if (!face||face<=0){showError('face',true);valid=false;}else showError('face',false);
  if (isNaN(couponRate)||couponRate<0){showError('coupon',true);valid=false;}else showError('coupon',false);
  if (!years||years<1){showError('years',true);valid=false;}else showError('years',false);
  if (!valid) return;

  let price, ytm;
  if (solveFor === 'price') {
    const reqYield = parseFloat(document.getElementById('req-yield').value)/100;
    if (isNaN(reqYield)||reqYield<0){showError('req-yield',true);return;}else showError('req-yield',false);
    price = bondPrice(face, couponRate, years, reqYield, couponFreq);
    ytm = reqYield;
  } else {
    const mktP = parseFloat(document.getElementById('mkt-price').value);
    if (!mktP||mktP<=0){showError('mkt-price',true);return;}else showError('mkt-price',false);
    price = mktP;
    ytm = calcYTM(face, couponRate, years, mktP, couponFreq);
  }

  const annualCoupon = face * couponRate;
  const currentYield = annualCoupon / price * 100;
  const duration = calcDuration(face, couponRate, years, ytm, couponFreq);
  const modDuration = duration / (1 + ytm/couponFreq);
  const totalCoupons = annualCoupon * years;
  const capGain = price - face;

  let priceStatus, pillClass;
  if (Math.abs(price-face)<0.5){priceStatus='Trading at Par';pillClass='par';}
  else if (price > face){priceStatus='Trading at Premium';pillClass='premium';}
  else{priceStatus='Trading at Discount';pillClass='discount';}

  document.getElementById('empty-state').style.display='none';
  document.getElementById('results-content').style.display='block';
  document.getElementById('chart-panel').style.display='block';

  document.getElementById('hero-label').textContent = solveFor==='price' ? 'Bond Price' : 'Yield to Maturity';
  document.getElementById('hero-value').textContent = solveFor==='price' ? fmt(price) : fmtPct(ytm*100);
  document.getElementById('hero-sub').textContent = solveFor==='price' ? `YTM: ${fmtPct(ytm*100)} | Face: ${fmt(face)}` : `Market Price: ${fmt(price)} | Coupon: ${fmtPct(couponRate*100)}`;
  const pill = document.getElementById('status-pill');
  pill.textContent = priceStatus; pill.className = 'status-pill '+pillClass;

  document.getElementById('res-coupon-pay').textContent = fmt(annualCoupon);
  document.getElementById('res-cy').textContent = currentYield.toFixed(4)+'%';
  document.getElementById('res-duration').textContent = duration.toFixed(4)+' yrs';
  document.getElementById('res-mod-dur').textContent = modDuration.toFixed(4);
  document.getElementById('res-total-coupon').textContent = fmt(totalCoupons);
  document.getElementById('res-cap-gain').textContent = (capGain>=0?'+':'')+fmt(capGain);
  document.getElementById('res-cap-gain').style.color = capGain>=0?'#4ade80':'#f87171';

  // Price-yield curve
  const yields=[], prices=[];
  for (let y=0.5;y<=15;y+=0.25) {
    yields.push(y.toFixed(2)+'%');
    prices.push(parseFloat(bondPrice(face,couponRate,years,y/100,couponFreq).toFixed(2)));
  }

  const ctx = document.getElementById('bondChart').getContext('2d');
  const gradBlue = ctx.createLinearGradient(0,0,0,260);
  gradBlue.addColorStop(0,'rgba(96,165,250,0.35)');
  gradBlue.addColorStop(1,'rgba(96,165,250,0.02)');

  if (chartInstance) chartInstance.destroy();
  chartInstance = new Chart(ctx,{
    type:'line',
    data:{labels:yields,datasets:[{label:'Bond Price',data:prices,borderColor:'#60a5fa',backgroundColor:gradBlue,borderWidth:2.5,fill:true,tension:0.4,pointRadius:0,pointHoverRadius:5,pointHoverBackgroundColor:'#60a5fa'}]},
    options:{
      responsive:true,maintainAspectRatio:false,
      animation:{duration:700,easing:'easeInOutQuart'},
      interaction:{mode:'index',intersect:false},
      plugins:{
        legend:{labels:{color:'#8A95A3',font:{family:'DM Sans',size:11},boxWidth:12}},
        tooltip:{backgroundColor:'#0E1F3D',borderColor:'rgba(201,168,76,0.3)',borderWidth:1,titleColor:'#C9A84C',bodyColor:'#F8F5EE',padding:12,callbacks:{title:i=>'Yield: '+i[0].label,label:c=>' Bond Price: '+fmt(c.raw)}}
      },
      scales:{
        x:{grid:{color:'rgba(255,255,255,0.04)'},ticks:{color:'#8A95A3',font:{family:'DM Sans',size:9},maxTicksLimit:12},title:{display:true,text:'Yield (%)',color:'#8A95A3',font:{family:'DM Sans',size:10}}},
        y:{grid:{color:'rgba(255,255,255,0.04)'},ticks:{color:'#8A95A3',font:{family:'DM Sans',size:10},callback:v=>'$'+v.toLocaleString()},title:{display:true,text:'Price ($)',color:'#8A95A3',font:{family:'DM Sans',size:10}}}
      }
    }
  });
}
document.querySelectorAll('.field').forEach(f=>f.addEventListener('keydown',e=>{if(e.key==='Enter')calculate();}));
</script>
</body>
</html>
